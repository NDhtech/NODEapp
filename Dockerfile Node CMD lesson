1Ô∏è‚É£ What CMD does in a Dockerfile (mental model)

Think of CMD as ‚Äúhow the container starts the app‚Äù.

When the container runs, Docker executes one command as PID 1, for example:

node index.js


or

npm start


So the question becomes:

What is the most direct, predictable, and production-safe way to start my Node app?

2Ô∏è‚É£ What npm start actually does

When you write:

CMD ["npm", "start"]


Docker runs:

npm start


Which then looks in your package.json:

{
  "scripts": {
    "start": "node index.js"
  }
}


So the real execution chain is:

Docker ‚Üí npm ‚Üí node ‚Üí index.js

Downsides of npm start in Docker
Issue	Why it matters
Extra process layer	npm becomes PID 1 instead of node
Signal handling	Ctrl+C / SIGTERM may not shut down Node cleanly
Slower startup	npm does extra work
Less explicit	Dockerfile hides how the app really runs

‚ö†Ô∏è This is why npm start is usually discouraged in production containers

3Ô∏è‚É£ What node index.js does

When you write:

CMD ["node", "index.js"]


Docker runs Node directly:

Docker ‚Üí node ‚Üí index.js

Advantages

‚úÖ Node is PID 1
‚úÖ Clean signal handling
‚úÖ Faster startup
‚úÖ Explicit and predictable
‚úÖ Industry best practice

This is why you‚Äôll see it in most production-grade Dockerfiles.

4Ô∏è‚É£ The golden rule (memorize this)

Use node index.js in Docker unless you have a specific reason not to.

5Ô∏è‚É£ When CMD ["node", "index.js"] is the RIGHT choice ‚úÖ

Use this when:

‚úî Your app entry file is known (index.js, server.js, app.js)
‚úî You‚Äôre building a production image
‚úî You want clean shutdowns (Kubernetes, ECS, Docker Compose)
‚úî You don‚Äôt need npm lifecycle hooks

Example (recommended)
FROM node:20-alpine

WORKDIR /app

COPY package*.json ./
RUN npm ci --only=production

COPY . .

EXPOSE 3000

CMD ["node", "index.js"]

6Ô∏è‚É£ When CMD ["npm", "start"] is acceptable ‚ö†Ô∏è

Use this ONLY when:

‚úî Your start command is complex
‚úî You rely on npm scripts for logic
‚úî You‚Äôre in development, not production

Example:

"scripts": {
  "start": "node --env-file=.env index.js"
}

CMD ["npm", "start"]


Still valid‚Äîbut less ideal.

7Ô∏è‚É£ What about ENTRYPOINT vs CMD?

For Node apps:

‚úÖ Use exec form (JSON array)

‚ùå Avoid shell form

Good
CMD ["node", "index.js"]

Bad
CMD node index.js


Shell form breaks signal handling.

8Ô∏è‚É£ Quick decision checklist üß†

Ask yourself:

Do I know the main JS file?

Yes ‚Üí node index.js

Is this a production container?

Yes ‚Üí node index.js

Am I just testing locally?

npm start is fine

Running in Kubernetes?

Always node index.js

9Ô∏è‚É£ One-liner rule you can reuse forever

Dockerfiles should run the final process directly, not through npm.
